<!DOCTYPE html>
<html>
<head>
  <title>Google Drive Image Sender</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <button id="authorize_button" style="display:none;">تسجيل دخول جوجل</button>
  <button id="signout_button" style="display:none;">تسجيل خروج</button>

  <div id="content"></div>

  <script>
    const CLIENT_ID = '869200348342-ijiun242m66rsrj55pk87ttbd0ubs4hh.apps.googleusercontent.com';
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

    const authorizeButton = document.getElementById('authorize_button');
    const signoutButton = document.getElementById('signout_button');
    const content = document.getElementById('content');

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        clientId: CLIENT_ID,
        scope: SCOPES,
      }).then(() => {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

        authorizeButton.onclick = () => gapi.auth2.getAuthInstance().signIn();
        signoutButton.onclick = () => gapi.auth2.getAuthInstance().signOut();
      }, (error) => {
        content.innerText = JSON.stringify(error, null, 2);
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'block';
        listFiles();
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display = 'none';
        content.innerText = 'من فضلك قم بتسجيل الدخول للوصول إلى الصور';
      }
    }

    function listFiles() {
      gapi.client.drive.files.list({
        'pageSize': 50,
        'fields': 'files(id, name, mimeType)',
        'q': "mimeType contains 'image/'"
      }).then(function(response) {
        const files = response.result.files;
        if (files && files.length > 0) {
          content.innerHTML = 'الصور التي سيتم إرسالها:<br><ul>' +
            files.map(f => `<li>${f.name} (ID: ${f.id})</li>`).join('') + '</ul>';

          // هنا يمكن ترسل IDs الصور للخادم (Node.js) عشان تبعتهم للتليجرام
        } else {
          content.innerText = 'لا توجد صور في Google Drive.';
        }
      });
    }

    handleClientLoad();
  </script>
</body>
</html>
