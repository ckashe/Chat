<!DOCTYPE html>
<html>
<head>
  <title>Google Drive Image Sender - GIS</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div id="g_id_onload"
       data-client_id="869200348342-ijiun242m66rsrj55pk87ttbd0ubs4hh.apps.googleusercontent.com"
       data-callback="handleCredentialResponse"
       data-scope="https://www.googleapis.com/auth/drive.readonly"
       data-auto_prompt="false">
  </div>

  <div class="g_id_signin" data-type="standard"></div>

  <div id="content">من فضلك قم بتسجيل الدخول للوصول إلى الصور</div>

  <script>
    let accessToken = '';

    function handleCredentialResponse(response) {
      // JWT ID token - مش هنعتمد عليها عشان الوصول للـ API
      // لازم نعمل OAuth flow للحصول على Access Token منفصل
      document.getElementById('content').innerText = 'جارٍ الحصول على صلاحية الوصول...';

      // نستخدم رمز ID token لتحويله إلى Access Token (محتاج سيرفر)
      // عشان كده هنا هنستخدم طريقة مبسطة عبر OAuth2 implicit flow من جديد
      // أو نستخدم Google API Client Library بشكل محدود مع token جديد

      // الحل هنا: هنعمل طلب OAuth2 authorization يدوي للحصول على Access Token
      // أو نستعمل سيرفر Node.js (في الخطوة الجاية) لإكمال flow

      // لو عايز نكمل هنا بالمتصفح فقط، محتاج طريقة أخرى (هي معقدة شوية)

      // عشان نبدأ نستخدم API, ممكن نعمل مثل الآتي:
      startOAuth2Flow();
    }

    function startOAuth2Flow() {
      const params = new URLSearchParams({
        client_id: '869200348342-ijiun242m66rsrj55pk87ttbd0ubs4hh.apps.googleusercontent.com',
        redirect_uri: window.location.origin + '/oauth2callback.html',
        response_type: 'token',
        scope: 'https://www.googleapis.com/auth/drive.readonly',
        include_granted_scopes: 'true',
        state: 'pass-through value'
      });
      window.location = 'https://accounts.google.com/o/oauth2/v2/auth?' + params.toString();
    }
  </script>
</body>
</html>
